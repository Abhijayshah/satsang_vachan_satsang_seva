<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>निरीक्षण • पत्रिका</title>
    <link rel="stylesheet" href="assets/styles.css" />
    <style>
      .diag { background:#fff; border:1px solid #ddd; padding:0.75rem; }
      .diag h1 { margin:0 0 0.5rem; font-size:1.25rem; }
      .diag .summary { margin:0.5rem 0; color:#555; }
      .diag .issues { margin:0; padding-left:1rem; }
      .diag .ok { color:green; }
      .diag .warn { color:#b22222; }
      .diag .page { font-weight:600; }
    </style>
  </head>
  <body>
    <header class="site-header">
      <div class="brand">
        <div class="brand-line brand-line-1">जय गुरुदेव</div>
        <div class="brand-line brand-line-2">शाकाहारी सदाचारी बाल संघ</div>
        <div class="brand-line brand-line-3">बालक सप्ताहिक पत्रिका</div>
      </div>
      <nav class="site-nav">
        <a href="index.html">Home</a>
        <a href="issues/index.html">Patrika</a>
      </nav>
    </header>
    <main class="layout">
      <section class="diag">
        <h1>Diagnostics</h1>
        <p class="summary" id="diagSummary">Running checks…</p>
        <ul class="issues" id="diagList"></ul>
      </section>
    </main>
    <footer class="site-footer">
      <div class="footer-links">
        <a href="https://www.youtube.com/channel/UCEMWkI5hw0oLnaFJAwCMECg" target="_blank" rel="noopener noreferrer">YouTube</a>
        <a href="https://www.instagram.com/satsang_vachan_satsang_seva/" target="_blank" rel="noopener noreferrer">Instagram</a>
        <a href="mailto:abhijayshah74@gmail.com">Email</a>
        <a href="https://wa.me/917879028316" target="_blank" rel="noopener noreferrer">Contact</a>
      </div>
    </footer>
    <script>
      const pages=[
        'index.html',
        'issues/index.html',
        'issues/2025-11-24/index.html'
      ];
      async function fetchDoc(path){
        const res=await fetch(path);
        const txt=await res.text();
        const doc=new DOMParser().parseFromString(txt,'text/html');
        const url=new URL(path,location.origin+'/');
        return {ok:res.ok,doc,txt,path,url};
      }
      function abs(from,href){return new URL(href,from.url).toString()}
      async function exists(url){try{const r=await fetch(url,{method:'HEAD'});return r.ok}catch{return false}}
      function push(list,page,msg,fix){list.push({page:page.path,msg,fix})}
      async function checkPage(page){
        const out=[];
        if(!page.ok) push(out,page,'Page not reachable',`Ensure ${page.path} exists`);
        const title=(page.doc.querySelector('title')?.textContent||'').toLowerCase();
        if(!title.includes('patrika')) push(out,page,'Title does not contain "Patrika"','Update <title> to include Patrika');
        const raw=page.txt;
        if(raw.includes('Daily Issues')) push(out,page,'Found "Daily Issues"','Rename to "Daily Patrika"');
        if(/\bIssue\s+\d{4}-\d{2}-\d{2}\b/.test(raw)) push(out,page,'Found "Issue YYYY-MM-DD"','Rename to "Patrika YYYY-MM-DD"');
        const navLinks=Array.from(page.doc.querySelectorAll('.site-nav a'));
        const navText=navLinks.map(a=>a.textContent.trim().toLowerCase());
        if(navText.includes('issues')) push(out,page,'Nav shows "Issues"','Change to "Patrika"');
        const styles=Array.from(page.doc.querySelectorAll('link[rel="stylesheet"]'));
        for(const l of styles){const url=abs(page,l.getAttribute('href')||'');if(url){const ok=await exists(url);if(!ok) push(out,page,`Missing stylesheet ${url}`,'Fix link href or file path')}}
        const scripts=Array.from(page.doc.querySelectorAll('script[src]'));
        for(const s of scripts){const url=abs(page,s.getAttribute('src')||'');if(url){const ok=await exists(url);if(!ok) push(out,page,`Missing script ${url}`,'Fix script src or file path')}}
        const imgs=Array.from(page.doc.querySelectorAll('img'));
        for(const img of imgs){if(!img.getAttribute('alt')) push(out,page,'Image missing alt','Add alt text for accessibility')}
        return out;
      }
      async function run(){
        const list=document.getElementById('diagList');
        const summary=document.getElementById('diagSummary');
        list.innerHTML='';
        let total=0;
        for(const p of pages){
          const page=await fetchDoc(p);
          const issues=await checkPage(page);
          if(issues.length===0){
            const li=document.createElement('li');
            li.className='ok';
            li.textContent=`${p}: OK`;
            list.appendChild(li);
          } else {
            for(const i of issues){
              const li=document.createElement('li');
              li.className='warn';
              li.innerHTML=`<span class="page">${i.page}</span> — ${i.msg} • <em>${i.fix}</em>`;
              list.appendChild(li);
            }
          }
          total+=issues.length;
        }
        summary.textContent=total===0?'No issues detected':'Issues found: '+total;
      }
      if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',run)}else{run()}
    </script>
  </body>
</html>
